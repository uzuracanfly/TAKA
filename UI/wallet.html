<!DOCTYPE html>
<html lang="ja">
<head>
<title>TAKA Wallet | Distributed database.</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes" />
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
<link rel="shortcut icon" href="lib/TAKAICON_NoBackground">
</head>

<style type="text/css">
<!--
#outer
{
	width:100%;
	padding: 0;
	margin: 0;
}
#inner
{
	width:100%;
	padding: 0;
	margin: 0 auto;
	position: absolute;
	top: 300px;
}
.sub
{
	width:100%;
	margin:0 auto;
}


.btn-border-bottom {
	position: relative;
	display: inline-block;
	font-weight: bold;
	padding: 0.25em 0;
	text-decoration: none;
	color: #67c5ff;	
	background-color: rgba(255,255,255,0.8);
}

.btn-border-bottom:before {
	position: absolute;
	content: '';
	width: 100%;
	height: 4px;
	top:100%;
	left: 0;
	border-radius: 3px;
	background:#67c5ff;
	transition: .2s;
}

.btn-border-bottom:hover:before {
	top: -webkit-calc(100% - 3px);
	top: calc(100% - 3px);
}



h1 {
	color: #6594e0;/*文字色*/
	/*線の種類（点線）2px 線色*/
	border-bottom: dashed 2px #6594e0;
}
h2 {
	color: #364e96;/*文字色*/
	border: solid 3px #364e96;/*線色*/
	border-radius: 0.5em;/*角丸*/
}

-->
</style>









<div id="outer">
	<div id="inner">
	</div>
</div>









<script src="//code.jquery.com/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/clipboard.js/1.5.3/clipboard.min.js"></script>

<script src="lib/basicfunctions"></script>
<script src="lib/form"></script>
<script src="lib/notification"></script>

<script src="lib/ETHCoindRapper"></script>
<script src="lib/TAKALibRapper"></script>

<script>
	const TAKAAPI = new TAKA.API("MYURL/api");
	const TAKAFUNCTIONS = new TAKA.RappingFunctions("MYURL/api");

	let Notification = new notification();
	let account = {};



	//TAKAAPI.exchange("sell","0047933be15e76002ef3ae8f1e722465aea86c0ce70c0369bffe80b7ef4cc2d5","0xfab5600CAf07EAeABb55305B1E559a7a5aeEbA60",1300);





	async function ExchangeETAKAToTAKA(amount){
		let ETHPrivkey = new TAKA.HASHS.hashs().sha256(account["privkey"]);
		let COIND = new ETHCOINd.ETHCoind(ETHPrivkey,"0x62B447cC1DD78Ed980Cf2B5068bAE8ABd7E9bD97");

		/* ノードに指定分の通貨が用意されているか */
		let PayTAKABalance = TAKAAPI.getaccount("PAYTAKAADDRESS");
		if (PayTAKABalance < amount){
			return 2;
		}

		let paytxid = await COIND.SendToken("PAYETAKAADDRESS",amount);

		if (!paytxid){
			return 3;
		}

		let bool = TAKAAPI.exchange("buy",paytxid,account["address"],amount);

		return bool;
	};


	async function ExchangeTAKAToETAKA(amount){
		let ETHPrivkey = new TAKA.HASHS.hashs().sha256(account["privkey"]);
		let COIND = new ETHCOINd.ETHCoind(ETHPrivkey,"0x62B447cC1DD78Ed980Cf2B5068bAE8ABd7E9bD97");

		/* ノードに指定分の通貨が用意されているか */
		let PayETAKABalance = await COIND.GetBalanceToken("PAYETAKAADDRESS");
		if (PayETAKABalance < amount){
			return 2;
		}
		let PayETHBalance = await COIND.GetBalanceCoin("PAYETAKAADDRESS");
		if (PayETHBalance < 0.001*(10**18)){
			return 2;
		}

		let result = await TAKAFUNCTIONS.SendTransactionWithSendFee(account["privkey"],1,"pay","PAYTAKAADDRESS",amount,"",undefined,120);

		if (!result["txid"]){
			return 3;
		}

		let bool = TAKAAPI.exchange("sell",result["txid"],(await COIND.GetKeys())["address"],amount);

		return bool;
	};


	async function GetETHAccount(){
		let ETHPrivkey = new TAKA.HASHS.hashs().sha256(account["privkey"]);
		let COIND = new ETHCOINd.ETHCoind(ETHPrivkey,"0x62B447cC1DD78Ed980Cf2B5068bAE8ABd7E9bD97");

		let Callback = {
			"privkey":ETHPrivkey,
			"address":(await COIND.GetKeys())["address"],
			"ETHBalance":(await COIND.GetBalanceCoin()),
			"ETAKABalance":(await COIND.GetBalanceToken())
		}

		return Callback;
	}



	async function ExchangeForm(TAKABalance){
		let ETHAccountData = await GetETHAccount();

		let formargs = [
			["head",await GetLangText("ETHとETAKAの入金アドレス","ETH and ETAKA Address")],
			["text",ETHAccountData["address"]],
			["head",await GetLangText("ETH残高","ETH Balance")],
			["text",parseInt(ETHAccountData["ETHBalance"])/(10**18)],
			["head",await GetLangText("ETAKA残高","ETAKA Balance")],
			["text",ETHAccountData["ETAKABalance"]],
			[
				"button",
				"ETAKA => TAKA",
				async function()
				{
					let ETAKAToTAKAForm = new form(
						[
							["title","ETAKA => TAKA"],
							["input",await GetLangText("数量","amount"),"amount"],
							[
								"button",
								"Done",
								async function()
								{
									let amount = document.getElementById("amount").value;
									amount = parseInt(amount);

									let TopLoadForm = new form(
										[
											["title",await GetLangText("送金中.....","Sending.....")]
										],
										"TopLoadForm"
									);

									let result = await ExchangeETAKAToTAKA(amount);
									TopLoadForm.DeleteForm();
									if (result == 1){
										let TopLoadForm = new form(
											[
												["title",await GetLangText("申請しました。","Ordered.")],
												[
													"button",
													"Done",
													async function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									}else if (result == 2){
										let TopLoadForm = new form(
											[
												["title",await GetLangText("失敗","Error.")],
												["text",await GetLangText("交換する通貨は準備されていません。","The currency to be exchanged is not prepared.")],
												[
													"button",
													"Done",
													async function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									}else if (result == 3){
										let TopLoadForm = new form(
											[
												["title",await GetLangText("失敗","Error.")],
												["text",await GetLangText("ETHまたはETAKAが不足しています。","Low ETH or ETAKA.")],
												[
													"button",
													"Done",
													async function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									};

								}
							],
						],
						"ETAKAToTAKAForm"
					);

				}
			],
			[
				"button",
				"TAKA => ETAKA",
				async function()
				{
					let TAKAToETAKAForm = new form(
						[
							["title","TAKA => ETAKA"],
							["input","amount","amount"],
							[
								"button",
								"Done",
								async function()
								{
									let amount = document.getElementById("amount").value;
									amount = parseInt(amount);

									let TopLoadForm = new form(
										[
											["title",await GetLangText("送金中.....","Sending.....")]
										],
										"TopLoadForm"
									);

									let result = await ExchangeTAKAToETAKA(amount);
									TopLoadForm.DeleteForm();
									if (result == 1){
										let TopLoadForm = new form(
											[
												["title",await GetLangText("申請しました。","Ordered.")],
												[
													"button",
													"Done",
													async function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									}else if (result == 2){
										let TopLoadForm = new form(
											[
												["title",await GetLangText("失敗","Error.")],
												["text",await GetLangText("交換する通貨は準備されていません。","The currency to be exchanged is not prepared.")],
												[
													"button",
													"Done",
													async function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									}else if (result == 3){
										let TopLoadForm = new form(
											[
												["title",await GetLangText("失敗","Error.")],
												["text",await GetLangText("TAKAが不足しています。","Low TAKA.")],
												[
													"button",
													"Done",
													async function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									};
								}
							],
						],
						"TAKAToETAKAForm"
					);

				}
			],
			[
				"button",
				await GetLangText("ETAKA出金","Withdraw ETAKA"),
				async function()
				{
					let WithdrawETAKAForm = new form(
						[
							["title",await GetLangText("ETAKA出金","Withdraw ETAKA")],
							["input",await GetLangText("送金先アドレス","toaddress"),"toaddress"],
							["input",await GetLangText("数量","amount"),"amount"],
							[
								"button",
								"Done",
								async function()
								{
									let toaddress = document.getElementById("toaddress").value;
									let amount = document.getElementById("amount").value;
									amount = parseInt(amount);


									let TopLoadForm = new form(
										[
											["title",await GetLangText("送金中.....","Sending.....")]
										],
										"TopLoadForm"
									);
									let ETHPrivkey = new TAKA.HASHS.hashs().sha256(account["privkey"]);
									let COIND = new ETHCOINd.ETHCoind(ETHPrivkey,"0x62B447cC1DD78Ed980Cf2B5068bAE8ABd7E9bD97");

									let txid = await COIND.SendToken(toaddress,amount);

									TopLoadForm.DeleteForm();

									let ResultForm = new form(
										[
											["title",await GetLangText("結果","Result")],
											["input",txid],
											[
												"button",
												"Done",
												async function()
												{
													ResultForm.DeleteForm();
													WithdrawETAKAForm.DeleteForm();
												}
											]
										],
										"ResultForm"
									);
								}
							],
						],
						"WithdrawETAKAForm"
					);
				}
			],
			[
				"button",
				await GetLangText("ETH出金","Withdraw ETH"),
				async function()
				{
					let WithdrawETAKAForm = new form(
						[
							["title",await GetLangText("ETAKA出金","Withdraw ETH")],
							["input",await GetLangText("送金先アドレス","toaddress"),"toaddress"],
							["input",await GetLangText("数量","amount"),"amount"],
							[
								"button",
								"Done",
								async function()
								{
									let toaddress = document.getElementById("toaddress").value;
									let amount = document.getElementById("amount").value;
									amount = parseInt(amount*(10**18));


									let TopLoadForm = new form(
										[
											["title",await GetLangText("送金中.....","Sending.....")]
										],
										"TopLoadForm"
									);
									let ETHPrivkey = new TAKA.HASHS.hashs().sha256(account["privkey"]);
									let COIND = new ETHCOINd.ETHCoind(ETHPrivkey);

									let txid = await COIND.SendCoin(toaddress,amount);

									TopLoadForm.DeleteForm();

									let ResultForm = new form(
										[
											["title",await GetLangText("結果","Result")],
											["input",txid],
											[
												"button",
												"Done",
												async function()
												{
													ResultForm.DeleteForm();
													WithdrawETAKAForm.DeleteForm();
												}
											]
										],
										"ResultForm"
									);
								}
							],
						],
						"WithdrawETAKAForm"
					);
				}
			],
			["head",await GetLangText("TAKA残高","TAKA Balance")],
			["text",TAKABalance],
		];


		let ExchangeFormIndex = new form(
			formargs,
			"ExchangeFormIndex"
		);
	};


	async function GetLangText(JPtext,ENtext){
		let lang = GetGetVars()["lang"];
		if (!lang){
			lang = "EN";
		}

		if (lang == "JP"){
			return JPtext;
		}
		if (lang == "EN"){
			return ENtext;
		}
	}


















	async function TopForm(){

		let LoginLoadForm = new form(
			[
				["title","Loading....."]
			],
			"LoginLoadForm"
		);


		TAKAAPI.getaccount(
			account["address"],
			0,
			async function(CallbackResult,CallbackArgs){
				let formargs = [
					["head",await GetLangText("入金アドレス","Address")],
					["text",account["address"]],
					["head",await GetLangText("残高","Balance")],
					["text",CallbackResult["balance"]],
					["head",await GetLangText("アクション","Action")],
					[
						"download",
						await GetLangText("KeyFile 保存","Save KeyFile"),
						"TAKA_KeyFile_"+account["address"]+".json",
						"text/plain",
						JSON.stringify(account)
					],
					[
						"button",
						await GetLangText("交換 ETAKA <=> TAKA","Exchange ETAKA <=> TAKA"),
						async function()
						{
							ExchangeForm(CallbackResult["balance"]);
						}
					],
					[
						"button",
						await GetLangText("出金","Withdraw"),
						async function()
						{
							let formargs = [
								["title",await GetLangText("出金","Withdraw")],
								["input",await GetLangText("送金先アドレス","toaddress"),"toaddress"],
								["input",await GetLangText("数量","amount"),"amount"],
								[
									"button",
									"send",
									async function()
									{
										let toaddress = document.getElementById("toaddress").value;
										let amount = document.getElementById("amount").value;
										amount = parseInt(amount);


										let result = TAKAFUNCTIONS.SendTransactionWithSendFee(account["privkey"],1,"pay",toaddress,amount,"");


										//送信ロード画面
										let TopLoadForm = new form(
											[
												["title",await GetLangText("送金中.....","Sending.....")]
											],
											"TopLoadForm"
										);


										result.then(async function(TxResult){
											TopLoadForm.DeleteForm();

											let TopResultForm = new form(
												[
													["title",await GetLangText("結果","Result")],
													["head",await GetLangText("結果","Result")],
													["input",await GetLangText("結果","Result"),"result"],
													[
														"button",
														await GetLangText("状況確認","State"),
														async function()
														{
															window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
														}
													],
													["head",await GetLangText("生トランザクションデータ","RawTx")],
													["input",await GetLangText("生トランザクションデータ","RawTx"),"rawtx"],
													[
														"button",
														"Done",
														async function()
														{
															TopResultForm.DeleteForm();
															TopWithdrawForm.DeleteForm();
														}
													]
												],
												"TopResultForm"
											);

											document.getElementById("result").value = TxResult["txid"];
											document.getElementById("rawtx").value = TxResult["rawtx"];
										});
									}
								]
							]


							let TopWithdrawForm = new form(
								formargs,
								"TopWithdrawForm"
							);
						}
					],
					[
						"button",
						await GetLangText("タグ申請","Tag Order"),
						async function()
						{
							let TopTagOrderForm = new form(
								[
									["title",await GetLangText("タグ申請","Tag Order")],
									["input","tag","tag"],
									["select","permissiontype",[[await GetLangText("すべてのアカウントがトランザクション追加可能","Any account can add transactions."),0],[await GetLangText("タグのオーナーのみトランザクション追加可能","Owner only"),1],[await GetLangText("'TagAddPermit'で加えられたアカウントのみトランザクション追加可能","Only accounts added with 'TagAddPermit'"),2]]],
									["input",await GetLangText("[オプション] POWの難易度 (ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff)","[OPTION] Pow Target (ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff)"),"powtarget"],
									["input",await GetLangText("[オプション] 最大データサイズ (10000)","[OPTION] Data MaxSize In Byte (10000)"),"DataMaxSizeInByte"],
									["input",await GetLangText("[オプション] トランザクション生成時手数料を回収するアドレス","[OPTION] Fee To Address"),"FeeToAddress"],
									["input",await GetLangText("[オプション] トランザクション生成時手数料","[OPTION] Fee Amount"),"FeeAmount"],
									[
										"button",
										"send",
										async function()
										{
											let tag = document.getElementById("tag").value;
											let permissiontype = parseInt(document.getElementById("permissiontype").value);
											let powtarget = document.getElementById("powtarget").value;
											let DataMaxSizeInByte = parseInt(document.getElementById("DataMaxSizeInByte").value);
											let FeeToAddress = document.getElementById("FeeToAddress").value;
											let FeeAmount = parseInt(document.getElementById("FeeAmount").value);

											if (!powtarget){
												powtarget = "0000000000000000000000000000000000000000000000000000000000000000";
											};

											if (!DataMaxSizeInByte){
												DataMaxSizeInByte = 10000;
											}

											if (!FeeToAddress){
												FeeToAddress = "";
											}

											if (!FeeAmount){
												FeeAmount = 0;
											}



											//TagOrderのデータ生成
											let objdata = {
												"tag":tag,
												"permissiontype":permissiontype,
												"powtarget":powtarget,
												"DataMaxSizeInByte":DataMaxSizeInByte,
												"FeeToAddress":FeeToAddress,
												"FeeAmount":FeeAmount,
											};

											let TXDATA = new TAKA.TRANSACTIONTOOLS_TAGORDER.TagOrderData("",objdata);
											let rawdata = TXDATA.GetRawData();



											//TagOrderTx作成
											let result = TAKAFUNCTIONS.SendTransactionWithSendFee(account["privkey"],12,"tagorder","0000000000000000000000000000000000000000",0,rawdata);

											TopLoadForm = new form(
												[
													["title",await GetLangText("送金中.....","Sending.....")]
												],
												"TopLoadForm"
											);

											result.then(async function(TxResult){
												TopLoadForm.DeleteForm();

												let TopResultForm = new form(
													[
														["title",await GetLangText("結果","Result")],
														["head",await GetLangText("結果","Result")],
														["input",await GetLangText("結果","Result"),"result"],
														[
															"button",
															await GetLangText("状況確認","State"),
															async function()
															{
																window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
															}
														],
														["head",await GetLangText("生トランザクションデータ","RawTx")],
														["input",await GetLangText("生トランザクションデータ","RawTx"),"rawtx"],
														[
															"button",
															"Done",
															async function()
															{
																TopResultForm.DeleteForm();
																TopTagOrderForm.DeleteForm();
															}
														]
													],
													"TopResultForm"
												);

												document.getElementById("result").value = TxResult["txid"];
												document.getElementById("rawtx").value = TxResult["rawtx"];
											}).catch(async function(e){
												console.log(e);
											});
										}
									]
								],
								"TopTagOrderForm"
							);
						}
					],
					[
						"button",
						await GetLangText("タグ報酬","Tag Reward"),
						async function()
						{
							let TopTagrewardForm = new form(
								[
									["title",await GetLangText("タグ報酬","Tag Reward")],
									["text",await GetLangText("選択したタグのデータを保持しているノード管理者に報酬を支払う","You can pay reward for node administrator keeping the specified tag.")],
									["input","tag","tag"],
									["input",await GetLangText("数量","amount"),"amount"],
									[
										"button",
										"send",
										async function()
										{
											let tag = document.getElementById("tag").value;
											let amount = document.getElementById("amount").value;


											let RewardPrivkeyKeys = await (new TAKA.ACCOUNT.account().GetKeys());


											//送信ロード画面
											let TopLoadForm = new form(
												[
													["title",await GetLangText("送金中.....","Sending.....")]
												],
												"TopLoadForm"
											);


											let result = TAKAFUNCTIONS.SendTransactionWithSendFee(account["privkey"],1,"pay",RewardPrivkeyKeys["address"],amount,"");


											result.then(async function(FeeTxResult){
												TopLoadForm.DeleteForm();
												if (!FeeTxResult || !FeeTxResult["txid"]){
													let TopFailForm = new form(
														[
															["title",await GetLangText("失敗","FAIL")]
														],
														"TopFailForm"
													);
													return false;
												}



												let TagData = TAKAAPI.gettag(tag);
												let TagRewardWithTime = Math.floor(Date.now()/1000);
												let TagTxids = TagData["txids"];
												TagTxids = TagTxids.sort(TAKA.TRANSACTIONTOOLS_TAGREWARD.TxidLengthCompare);
												let TagtxidsMarkleroot = new TAKA.HASHS.hashs().GetMarkleroot(TagTxids);

												let UsingRawTxIndex = Math.floor( Math.random() * TagTxids.length )+1;
												let UsingRawTx = TAKAAPI.gettx(TagTxids[UsingRawTxIndex-1])["rawtx"];
												let commonkey = new TAKA.HASHS.hashs().sha256(TagtxidsMarkleroot + UsingRawTx);

												if (!commonkey){
													let TopFailForm = new form(
														[
															["title",await GetLangText("失敗","FAIL")]
														],
														"TopFailForm"
													);
													return false;
												}
												let EncryptoPrivkey = new TAKA.CRYPTO.common().GetEncryptedData(commonkey,RewardPrivkeyKeys["privkey"]);



												//tagrewardのデータ生成
												let objdata = {
													"tag":tag,
													"RewardAddress":RewardPrivkeyKeys["address"],
													"UsingRawTxIndex":UsingRawTxIndex,
													"EncryptoPrivkey":EncryptoPrivkey,
												};

												let TXDATA = new TAKA.TRANSACTIONTOOLS_TAGREWARD.TagrewardData("",objdata);
												let rawdata = TXDATA.GetRawData();



												TopLoadForm = new form(
													[
														["title",await GetLangText("送金中.....","Sending.....")]
													],
													"TopLoadForm"
												);

												//TagrewardTx作成
												let TagrewardResult = TAKAFUNCTIONS.SendTransactionWithSendFee(account["privkey"],11,"tagreward","0000000000000000000000000000000000000000",0,rawdata,TagRewardWithTime);


												///Tagrewardの結果発表
												TagrewardResult.then(async function(TxResult){
													TopLoadForm.DeleteForm();

													let TopResultForm = new form(
														[
															["title",await GetLangText("結果","Result")],
															["head",await GetLangText("結果","Result")],
															["input",await GetLangText("結果","Result"),"result"],
															[
																"button",
																await GetLangText("状況確認","State"),
																async function()
																{
																	window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
																}
															],
															["head",await GetLangText("生トランザクションデータ","RawTx")],
															["input",await GetLangText("生トランザクションデータ","RawTx"),"rawtx"],
															[
																"button",
																"Done",
																async function()
																{
																	TopResultForm.DeleteForm();
																	TopTagrewardForm.DeleteForm();
																}
															]
														],
														"TopResultForm"
													);

													document.getElementById("result").value = TxResult["txid"];
													document.getElementById("rawtx").value = TxResult["rawtx"];
												}).catch(async function(e){
													console.log(e);
												});

											}).catch(async function(e){
												console.log(e);
											});
										}
									]
								],
								"TopTagrewardForm",
							);
						}
					],
					[
						"button",
						await GetLangText("タグ権限追加","Tag Add Permit"),
						async function()
						{
							let TopTagAddpermForm = new form(
								[
									["title",await GetLangText("タグ権限追加","Tag Add Permit")],
									["text",await GetLangText("tagorderの時に権限タイプを2にした場合'tagaddpermit'で追加したアカウントのみトランザクションを生成できます。また権限タイプが2以外であっても'Set Contract Transaction'は'tagaddpermit'で加えられたアカウントのみトランザクション追加が可能です。","If 'permissiontype' is set to 2 at the time of 'tagorder', only 'tagaddpermit' users can send transactions.Even if 'permissiontype' is other than 2, only users who have 'tagaddpermit' for 'Set Contract Transaction' can send transactions.")],
									["input","tag","tag"],
									["input",await GetLangText("追加するアドレス","Add address"),"addaddress"],
									[
										"button",
										"send",
										async function()
										{
											let tag = document.getElementById("tag").value;
											let addaddress = document.getElementById("addaddress").value;

											//tagrewardのデータ生成
											let objdata = {
												"tag":tag,
												"address":addaddress,
											};

											let TXDATA = new TAKA.TRANSACTIONTOOLS_TAGADDPERMIT.TagAddPermitData("",objdata);
											let rawdata = TXDATA.GetRawData();

											let result = TAKAFUNCTIONS.SendTransactionWithSendFee(account["privkey"],13,"tagaddpermit","0000000000000000000000000000000000000000",0,rawdata);


											//送信ロード画面
											let TopLoadForm = new form(
												[
													["title",await GetLangText("送金中.....","Sending.....")]
												],
												"TopLoadForm"
											);

											result.then(async function(TxResult){
												TopLoadForm.DeleteForm();

												let TopResultForm = new form(
													[
														["title",await GetLangText("結果","Result")],
														["head",await GetLangText("結果","Result")],
														["input",await GetLangText("結果","Result"),"result"],
														[
															"button",
															await GetLangText("状況確認","State"),
															async function()
															{
																window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
															}
														],
														["head",await GetLangText("生トランザクションデータ","RawTx")],
														["input",await GetLangText("生トランザクションデータ","RawTx"),"rawtx"],
														[
															"button",
															"Done",
															async function()
															{
																TopResultForm.DeleteForm();
																TopTagOrderForm.DeleteForm();
															}
														]
													],
													"TopResultForm"
												);

												document.getElementById("result").value = TxResult["txid"];
												document.getElementById("rawtx").value = TxResult["rawtx"];

											}).catch(async function(e){
												console.log(e);
											});


										}
									]
								],
								"TopTagAddpermForm",
							);
						}
					],
					[
						"button",
						await GetLangText("データベース","Database"),
						async function()
						{
							let TopDatabaseForm = new form(
								[
									["title",await GetLangText("データベース","Database")],
									["input","tag","tag"],
									["input","data","data"],
									["input",await GetLangText("[オプション] indexを追加するアドレス","[OPTION] Add Address Index"),"AddAddressIndex"],
									["input",await GetLangText("[オプション] 共通鍵","[OPTION] commonkey (hex only)"),"commonkey"],
									[
										"button",
										"send",
										async function()
										{


											let tag = document.getElementById("tag").value;
											let data = document.getElementById("data").value;
											let AddAddressIndex = document.getElementById("AddAddressIndex").value;
											let commonkey = document.getElementById("commonkey").value;
											if (commonkey){
												data = new TAKA.CRYPTO.common().GetEncryptedData(commonkey,data);
											}


											let result = TAKAFUNCTIONS.SendTransactionWithSendFee(account["privkey"],101,tag,AddAddressIndex,0,data);


											//送信ロード画面
											let TopLoadForm = new form(
												[
													["title",await GetLangText("送金中.....","Sending.....")]
												],
												"TopLoadForm"
											);

											result.then(async function(TxResult){
												TopLoadForm.DeleteForm();

												let TopResultForm = new form(
													[
														["title",await GetLangText("結果","Result")],
														["head",await GetLangText("結果","Result")],
														["input",await GetLangText("結果","Result"),"result"],
														[
															"button",
															await GetLangText("状況確認","State"),
															async function()
															{
																window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
															}
														],
														["head",await GetLangText("生トランザクションデータ","RawTx")],
														["input",await GetLangText("生トランザクションデータ","RawTx"),"rawtx"],
														[
															"button",
															"Done",
															async function()
															{
																TopResultForm.DeleteForm();
																TopDatabaseForm.DeleteForm();
															}
														]
													],
													"TopResultForm"
												);

												document.getElementById("result").value = TxResult["txid"];
												document.getElementById("rawtx").value = TxResult["rawtx"];
												
											}).catch(async function(e){
												console.log(e);
											});


										}
									]
								],
								"TopDatabaseForm",
							);
						}
					],
					[
						"button",
						await GetLangText("コントラクト関数設定","Send Set Contract Transaction"),
						async function()
						{
							let SendSetContractTransactionForm = new form(
								[
									["title",await GetLangText("コントラクト関数設定","Send Set Contract Transaction")],
									["input","tag","tag"],
									["input",await GetLangText("関数名","FunctionName"),"FunctionName"],
									["select","CodeType",[["JavaScript",1]]],
									["textblog",await GetLangText("ソースコード","CodeData"),"CodeData"],
									[
										"button",
										"send",
										async function()
										{


											let tag = document.getElementById("tag").value;
											let FunctionName = document.getElementById("FunctionName").value;
											let CodeType = document.getElementById("CodeType").value;
											let CodeData = document.getElementById("CodeData").value;


											//tagrewardのデータ生成
											let objdata = {
												"FunctionName":FunctionName,
												"CodeType":CodeType,
												"CodeData":CodeData,
											};
											let TXDATA = new TAKA.TRANSACTIONTOOLS_CONTRACT.SetFunctionData("",objdata);
											let rawdata = TXDATA.GetRawData();

											let result = TAKAFUNCTIONS.SendTransactionWithSendFee(account["privkey"],111,tag,"0000000000000000000000000000000000000000",0,rawdata);


											//送信ロード画面
											let TopLoadForm = new form(
												[
													["title",await GetLangText("送金中.....","Sending.....")]
												],
												"TopLoadForm"
											);

											result.then(async function(TxResult){
												TopLoadForm.DeleteForm();

												let TopResultForm = new form(
													[
														["title",await GetLangText("結果","Result")],
														["head",await GetLangText("結果","Result")],
														["input",await GetLangText("結果","Result"),"result"],
														[
															"button",
															await GetLangText("状況確認","State"),
															async function()
															{
																window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
															}
														],
														["head",await GetLangText("生トランザクションデータ","RawTx")],
														["input",await GetLangText("生トランザクションデータ","RawTx"),"rawtx"],
														[
															"button",
															"Done",
															async function()
															{
																TopResultForm.DeleteForm();
																SendSetContractTransactionForm.DeleteForm();
															}
														]
													],
													"TopResultForm"
												);

												document.getElementById("result").value = TxResult["txid"];
												document.getElementById("rawtx").value = TxResult["rawtx"];
												
											}).catch(async function(e){
												console.log(e);
											});


										}
									]
								],
								"SendSetContractTransactionForm",
							);
						}
					],
					[
						"button",
						await GetLangText("コントラクト関数実行","Send Run Contract Transaction"),
						async function()
						{
							let SendRunContractTransactionForm = new form(
								[
									["title",await GetLangText("コントラクト関数実行","Send Run Contract Transaction")],
									["input","tag","tag"],
									["input",await GetLangText("関数名","FunctionName"),"FunctionName"],
									["input",await GetLangText('引数 ({"toaddress":"80ba149c1e71ca4576198998418bc47d4e297ab2","amount":1})','FunctionArgs ({"toaddress":"80ba149c1e71ca4576198998418bc47d4e297ab2","amount":1})'),"FunctionArgs"],
									["input",await GetLangText("[オプション] indexを追加するアドレス","[OPTION] Add Address Index"),"AddAddressIndex"],
									[
										"button",
										"send",
										async function()
										{
											let address = account["address"];
											let tag = document.getElementById("tag").value;
											let FunctionName = document.getElementById("FunctionName").value;
											let FunctionArgs = JSON.parse(document.getElementById("FunctionArgs").value);
											let AddAddressIndex = document.getElementById("AddAddressIndex").value;


											let ResultPlan = TAKAAPI.RunCode(address,tag,FunctionName,FunctionArgs);


											//tagrewardのデータ生成
											let objdata = {
												"FunctionName":FunctionName,
												"FunctionArgs":FunctionArgs,
												"result":ResultPlan["result"],
												"SetData":ResultPlan["SetData"],
											};
											let TXDATA = new TAKA.TRANSACTIONTOOLS_CONTRACT.RunFunctionData("",objdata);
											let rawdata = TXDATA.GetRawData();

											let result = TAKAFUNCTIONS.SendTransactionWithSendFee(account["privkey"],112,tag,AddAddressIndex,0,rawdata);


											//送信ロード画面
											let TopLoadForm = new form(
												[
													["title",await GetLangText("送金中.....","Sending.....")]
												],
												"TopLoadForm"
											);

											result.then(async function(TxResult){
												TopLoadForm.DeleteForm();

												let TopResultForm = new form(
													[
														["title",await GetLangText("結果","Result")],
														["head",await GetLangText("結果","Result")],
														["input",await GetLangText("結果","Result"),"result"],
														[
															"button",
															await GetLangText("状況確認","State"),
															async function()
															{
																window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
															}
														],
														["head",await GetLangText("生トランザクションデータ","RawTx")],
														["input",await GetLangText("生トランザクションデータ","RawTx"),"rawtx"],
														[
															"button",
															"Done",
															async function()
															{
																TopResultForm.DeleteForm();
																SendRunContractTransactionForm.DeleteForm();
															}
														]
													],
													"TopResultForm"
												);

												document.getElementById("result").value = TxResult["txid"];
												document.getElementById("rawtx").value = TxResult["rawtx"];
												
											}).catch(async function(e){
												console.log(e);
											});


										}
									]
								],
								"SendRunContractTransactionForm",
							);
						}
					],
					[
						"button",
						await GetLangText("コントラクト関数呼び出し","Call Run Contract Transaction"),
						async function()
						{
							let CallRunContractTransactionForm = new form(
								[
									["title",await GetLangText("コントラクト関数呼び出し","Call Run Contract Transaction")],
									["input","tag","tag"],
									["input",await GetLangText("関数名","FunctionName"),"FunctionName"],
									["input",await GetLangText('引数 ({})','FunctionArgs ({})'),"FunctionArgs"],
									["input",await GetLangText("[オプション] 参照するindexのアドレスリスト ([])","[OPTION] Address Indexs ([])"),"AddressIndexs"],
									["select","lastonly",[[await GetLangText("すべてのトランザクション参照","Do not use only the last tx of the tx or tag specified by indexs."),0],[await GetLangText("最近のトランザクションのみ参照","Use only the last tx of the tx or tag specified by indexs."),1]]],
									[
										"button",
										"send",
										async function()
										{
											let address = account["address"];
											let tag = document.getElementById("tag").value;
											let FunctionName = document.getElementById("FunctionName").value;
											let FunctionArgs = JSON.parse(document.getElementById("FunctionArgs").value);
											let AddressIndexs = document.getElementById("AddressIndexs").value;
											if (AddressIndexs){
												AddressIndexs = JSON.parse(AddressIndexs);	
											}else{
												AddressIndexs = [];
											}
											let lastonly = document.getElementById("lastonly").value;
											if (lastonly){
												lastonly = parseInt(lastonly);	
											}else{
												lastonly = 0;
											}



											let result = TAKAAPI.CallRunContractTransaction(address,tag,FunctionName,FunctionArgs,AddressIndexs,lastonly);


											let TopResultForm = new form(
												[
													["title",await GetLangText("結果","Result")],
													["head",await GetLangText("結果","Result")],
													["input",await GetLangText("結果","Result"),"result"],
													["head",await GetLangText("生トランザクションデータ","RawTx")],
													["input",await GetLangText("生トランザクションデータ","RawTx"),"rawtx"],
													[
														"button",
														"Done",
														async function()
														{
															TopResultForm.DeleteForm();
															CallRunContractTransactionForm.DeleteForm();
														}
													]
												],
												"TopResultForm"
											);

											document.getElementById("result").value = JSON.stringify(result);
											document.getElementById("rawtx").value = "";


										}
									]
								],
								"CallRunContractTransactionForm",
							);
						}
					],

				];

				let TopForm = new form(
					formargs,
					"TopForm"
				);

				LoginLoadForm.DeleteForm();
			},
			{}
		);

		return true;
	}
</script>





<script>
	window.onload = async function(){
		document.body.style.color = "rgba(0,0,0,1)";
		document.body.style.backgroundColor = "rgba(255,127,0,1)";



		if (!("lang" in GetGetVars())){
			let LangSelect = new form(
				[
					["title","What language is used?"],
					["button_img","lib/United-Kingdom",function(){window.location.href = location.protocol+'//'+location.hostname+'/wallet?lang=EN';},"100px"],
					["button_img","lib/Japan",function(){window.location.href = location.protocol+'//'+location.hostname+'/wallet?lang=JP';},"100px"],
				],
				"LangSelect",
			);
		};



		let EleLogin = element(
			{
				"name":"EleLogin",
				"attachele":document.body,
				"type":"div",
				"height":"50%",
				"width":"100%",
				"position":"fixed",
				"top":"0px",
				"left":"0px",
			}
		);





		let EleLoginInner = element(
			{
				"name":"EleLoginInner",
				"attachele":EleLogin,
				"type":"div",
				"width":"100%",
				"maxWidth":"1024px",
				"position":"relative",
			}
		);
		var IntervalID_EleLoginInner = setInterval(
			async function()
			{
				if (document.getElementById("EleLoginInner") == null){clearInterval(IntervalID_EleLoginInner);return 0;};

				EleLogin.style.top = window.innerHeight/2 - EleLogin.clientHeight/2 + "px";

				EleLoginInner.style.top = EleLogin.clientHeight/2 - EleLoginInner.clientHeight/2 + "px";
				EleLoginInner.style.left = EleLogin.clientWidth/2 - EleLoginInner.clientWidth/2 + "px";
			},
			10
		);



		let EleInputLogin = element(
			{
				"name":"privkey",
				"attachele":EleLoginInner,
				"type":"input",
				"height":"50px",
				"width":"100%",
				"placeholder":"MinPrivkey, privkey, pubkey, address",
				"textAlign":"center",
			}
		);
		let EleButtonLogin = element(
			{
				"name":"EleButtonLogin",
				"attachele":EleLoginInner,
				"type":"a",
				"class":"btn-border-bottom",
				"height":"50px",
				"width":"100%",
				"innerHTML":await GetLangText("ログイン","Login"),
				"textAlign":"center",
				"clickfunction":async function(){
					let privkey = document.getElementById("privkey").value;

					let keys = await (new TAKA.ACCOUNT.account(privkey)).GetKeys();

					account = keys;

					TopForm();
				}
			}
		);
		let EleButtonKeyFileLoad = element(
			{
				"name":"EleButtonKeyFileLoad",
				"attachele":EleLoginInner,
				"type":"a",
				"class":"btn-border-bottom",
				"height":"50px",
				"width":"100%",
				"innerHTML":await GetLangText("KeyFileを開く","Load KeyFile"),
				"textAlign":"center",
				"clickfunction":async function(){
					let FORMACTION = new form(
						[
							["title",await GetLangText("KeyFileを開く","Load KeyFile")],
							["file","FileData"],
							[
								"button",
								"Done",
								async function(){
									let FileData = document.getElementById("FileData").value;
									let data = (FileData.split(',')).slice(-1)[0];
									data = window.atob(data);
									data = JSON.parse(data);

									document.getElementById("privkey").value = data["MinPrivkey"];
									FORMACTION.DeleteForm();

									document.getElementById("EleButtonLogin").click();
								}
							]
						],
						"FORMACTION"
					);
				}
			}
		);
		let EleButtonNewAccount = element(
			{
				"name":"EleButtonNewAccount",
				"attachele":EleLoginInner,
				"type":"a",
				"class":"btn-border-bottom",
				"height":"50px",
				"width":"100%",
				"innerHTML":await GetLangText("新アカウント","NewAccount"),
				"textAlign":"center",
				"clickfunction":async function(){
					let keys = await (new TAKA.ACCOUNT.account()).GetKeys();

					let LoginNewAccountForm = new form(
						[
							["title",await GetLangText("新アカウント","NewAccount")],
							[
								"download",
								await GetLangText("KeyFile保存","Save KeyFile"),
								"TAKA_KeyFile_"+keys["address"]+".json",
								"text/plain",
								JSON.stringify(keys)
							],
							["head","MinPrivkey"],
							["input","MinPrivkey","MinPrivkey"],
							["head","Privkey"],
							["input","privkey","mprivkey"],
							["head","Pubkey"],
							["input","pubkey","pubkey"],
							["head","Address"],
							["input","address","address"],
						],
						"LoginNewAccountForm"
					);
					document.getElementById("MinPrivkey").value = keys["MinPrivkey"];
					document.getElementById("privkey").value = keys["MinPrivkey"];
					document.getElementById("mprivkey").value = keys["privkey"];
					document.getElementById("pubkey").value = keys["pubkey"];
					document.getElementById("address").value = keys["address"];
				}
			}
		);
	};

</script>