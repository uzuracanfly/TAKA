<!DOCTYPE html>
<html lang="ja">
<head>
<title>TAKA Wallet | Distributed large capacity database.</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes" />
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
</head>

<style type="text/css">
<!--
#outer
{
	width:100%;
	padding: 0;
	margin: 0;
}
#inner
{
	width:100%;
	padding: 0;
	margin: 0 auto;
	position: absolute;
	top: 300px;
}
.sub
{
	width:100%;
	margin:0 auto;
}


.btn-border-bottom {
	position: relative;
	display: inline-block;
	font-weight: bold;
	padding: 0.25em 0;
	text-decoration: none;
	color: #67c5ff;	
	background-color: rgba(255,255,255,0.8);
}

.btn-border-bottom:before {
	position: absolute;
	content: '';
	width: 100%;
	height: 4px;
	top:100%;
	left: 0;
	border-radius: 3px;
	background:#67c5ff;
	transition: .2s;
}

.btn-border-bottom:hover:before {
	top: -webkit-calc(100% - 3px);
	top: calc(100% - 3px);
}



h1 {
	color: #6594e0;/*文字色*/
	/*線の種類（点線）2px 線色*/
	border-bottom: dashed 2px #6594e0;
}
h2 {
	color: #364e96;/*文字色*/
	border: solid 3px #364e96;/*線色*/
	border-radius: 0.5em;/*角丸*/
}

-->
</style>









<div id="outer">
	<div id="inner">
	</div>
</div>









<script src="//code.jquery.com/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/clipboard.js/1.5.3/clipboard.min.js"></script>

<script src="lib/basicfunctions"></script>
<script src="lib/form"></script>
<script src="lib/notification"></script>

<script src="lib/ETHCoindRapper"></script>
<script src="lib/TAKALibRapper"></script>

<script>
	const TAKAAPI = new TAKA.API("MYURL");
	let Notification = new notification();
	let account = {};



	//TAKAAPI.exchange("sell","0047933be15e76002ef3ae8f1e722465aea86c0ce70c0369bffe80b7ef4cc2d5","0xfab5600CAf07EAeABb55305B1E559a7a5aeEbA60",1300);




	function SendTransaction(type,tag,toaddress,amount,data,privkey=account["privkey"]){
		return new Promise(async function (resolve, reject) {

			let address = (await new TAKA.ACCOUNT.account(privkey).GetKeys())["address"];

			let AccountData = TAKAAPI.getaccount(address,0);
			let MerkleRoot = "";
			let txs = [];
			if (tag in AccountData["txids"]){
				MerkleRoot = AccountData["txids"][tag]["MerkleRoot"];
				txs = AccountData["txids"][tag]["txs"];
			}
			let index = txs.length;
			let time = Math.floor(Date.now()/1000);

			let objtx = {
				"pubkey":account["pubkey"],
				"type":type,
				"time":time,
				"tag":tag,
				"index":index+1,
				"MerkleRoot":MerkleRoot,
				"toaddress":toaddress,
				"amount":parseInt(amount),
				"data":data,
				"sig":"",
				"nonce":0,
			};
			//console.log(objtx);
			let TargetTransaction = new TAKA.TRANSACTION.Transaction("",privkey,objtx);



			/* Targetの取得 */
			let target = BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");

			//最後のトランザクションの時間を取得
			let lasttxid = txs.slice(-1)[0];
			let LASTTX  = TAKA.TRANSACTION.GetTx(lasttxid);
			let lasttxtime = time - 60*10;
			if (LASTTX){
				lasttxtime = (await LASTTX.GetObjTx())["time"];
			}

			if (tag != "pay" && tag != "tagreward"){
				let objfirsttx = TAKAAPI.gettx(txs[0]);

				let FIRSTTXDATA = new TAKA.TRANSACTIONTOOLS_TAGORDER.TagOrderData(objfirsttx["data"]);
				let objdata = FIRSTTXDATA.GetObjData();

				target = await TargetTransaction.GetPOWTarget(await TargetTransaction.GetRawTx(),objdata["powtarget"],lasttxtime);
			}else{
				target = await TargetTransaction.GetPOWTarget(await TargetTransaction.GetRawTx(),null,lasttxtime);
			}




			let result = TargetTransaction.GetNonce(await TargetTransaction.GetRawTx(),target);
			let objsendtx = await TargetTransaction.GetObjTx();



			result.then(async function(nonce){

				objsendtx["nonce"] = nonce;

				TargetTransaction = new TAKA.TRANSACTION.Transaction("",privkey,objsendtx);
				let rawtx = await TargetTransaction.GetRawTx();


				TAKAAPI.sendtx(
					rawtx,
					function(CallbackResult,CallbackArgs){
						return resolve({"txid":CallbackResult,"rawtx":rawtx});
					}
				);
			});
		});
	};




	async function ExchangeETAKAToTAKA(amount){
		let ETHPrivkey = new TAKA.HASHS.hashs().sha256(account["privkey"]);
		let COIND = new ETHCOINd.ETHCoind(ETHPrivkey,"0x62B447cC1DD78Ed980Cf2B5068bAE8ABd7E9bD97");

		/* ノードに指定分の通貨が用意されているか */
		let PayTAKABalance = TAKAAPI.getaccount("PAYTAKAADDRESS");
		if (PayTAKABalance < amount){
			return 2;
		}

		let paytxid = await COIND.SendToken("PAYETAKAADDRESS",amount);

		if (!paytxid){
			return 3;
		}

		let bool = TAKAAPI.exchange("buy",paytxid,account["address"],amount);

		return bool;
	};


	async function ExchangeTAKAToETAKA(amount){
		let ETHPrivkey = new TAKA.HASHS.hashs().sha256(account["privkey"]);
		let COIND = new ETHCOINd.ETHCoind(ETHPrivkey,"0x62B447cC1DD78Ed980Cf2B5068bAE8ABd7E9bD97");

		/* ノードに指定分の通貨が用意されているか */
		let PayETAKABalance = COIND.GetBalanceToken("PAYETAKAADDRESS");
		if (PayETAKABalance < amount){
			return 2;
		}
		let PayETHBalance = COIND.GetBalanceCoin("PAYETAKAADDRESS");
		if (PayETHBalance < 0.001*(10**18)){
			return 2;
		}

		let result = await SendTransaction(1,"pay","PAYTAKAADDRESS",amount,"");

		if (!result){
			return 3;
		}

		let bool = TAKAAPI.exchange("sell",result["txid"],(await COIND.GetKeys())["address"],amount);

		return bool;
	};


	async function GetETHAccount(){
		let ETHPrivkey = new TAKA.HASHS.hashs().sha256(account["privkey"]);
		let COIND = new ETHCOINd.ETHCoind(ETHPrivkey,"0x62B447cC1DD78Ed980Cf2B5068bAE8ABd7E9bD97");

		let Callback = {
			"privkey":ETHPrivkey,
			"address":(await COIND.GetKeys())["address"],
			"ETHBalance":(await COIND.GetBalanceCoin()),
			"ETAKABalance":(await COIND.GetBalanceToken())
		}

		return Callback;
	}



	async function ExchangeForm(TAKABalance){
		let ETHAccountData = await GetETHAccount();

		let formargs = [
			["head","ETH and ETAKA Address"],
			["text",ETHAccountData["address"]],
			["head","ETH Balance"],
			["text",parseInt(ETHAccountData["ETHBalance"])/(10**18)],
			["head","ETAKA Balance"],
			["text",ETHAccountData["ETAKABalance"]],
			[
				"button",
				"ETAKA => TAKA",
				async function()
				{
					let ETAKAToTAKAForm = new form(
						[
							["title","ETAKA => TAKA"],
							["input","amount","amount"],
							[
								"button",
								"Done",
								async function()
								{

									let result = await ExchangeETAKAToTAKA(ETHAccountData["ETAKABalance"]);
									if (result == 1){
										let TopLoadForm = new form(
											[
												["title","Ordered."],
												[
													"button",
													"Done",
													function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									}else if (result == 2){
										let TopLoadForm = new form(
											[
												["title","Error."],
												["text","The currency to be exchanged is not prepared."],
												[
													"button",
													"Done",
													function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									}else if (result == 3){
										let TopLoadForm = new form(
											[
												["title","Error."],
												["text","Low ETH or ETAKA."],
												[
													"button",
													"Done",
													function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									};

								}
							],
						],
						"ETAKAToTAKAForm"
					);

				}
			],
			[
				"button",
				"TAKA => ETAKA",
				async function()
				{
					let TAKAToETAKAForm = new form(
						[
							["title","TAKA => ETAKA"],
							["input","amount","amount"],
							[
								"button",
								"Done",
								async function()
								{
									let result = await ExchangeTAKAToETAKA(TAKABalance);
									if (result == 1){
										let TopLoadForm = new form(
											[
												["title","Ordered."],
												[
													"button",
													"Done",
													function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									}else if (result == 2){
										let TopLoadForm = new form(
											[
												["title","Error."],
												["text","The currency to be exchanged is not prepared."],
												[
													"button",
													"Done",
													function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									}else if (result == 3){
										let TopLoadForm = new form(
											[
												["title","Error."],
												["text","Low TAKA."],
												[
													"button",
													"Done",
													function()
													{
														TopLoadForm.DeleteForm();
													}
												]
											],
											"TopLoadForm"
										);
									};
								}
							],
						],
						"TAKAToETAKAForm"
					);

				}
			],
			[
				"button",
				"Withdraw ETAKA",
				async function()
				{
					let WithdrawETAKAForm = new form(
						[
							["title","Withdraw ETAKA"],
							["input","toaddress","toaddress"],
							["input","amount","amount"],
							[
								"button",
								"Done",
								async function()
								{
									let toaddress = document.getElementById("toaddress").value;
									let amount = document.getElementById("amount").value;
									amount = parseInt(amount);

									let ETHPrivkey = new TAKA.HASHS.hashs().sha256(account["privkey"]);
									let COIND = new ETHCOINd.ETHCoind(ETHPrivkey,"0x62B447cC1DD78Ed980Cf2B5068bAE8ABd7E9bD97");

									let txid = await COIND.SendToken(toaddress,amount);

									let ResultForm = new form(
										[
											["title","Result"],
											["input",txid],
											[
												"button",
												"Done",
												function()
												{
													ResultForm.DeleteForm();
													WithdrawETAKAForm.DeleteForm();
												}
											]
										],
										"ResultForm"
									);
								}
							],
						],
						"WithdrawETAKAForm"
					);
				}
			],
			["head","TAKA Balance"],
			["text",TAKABalance],
		];


		let ExchangeFormIndex = new form(
			formargs,
			"ExchangeFormIndex"
		);
	};

















	async function TopForm(){

		let LoginLoadForm = new form(
			[
				["title","Loading....."]
			],
			"LoginLoadForm"
		);


		TAKAAPI.getaccount(
			account["address"],
			0,
			async function(CallbackResult,CallbackArgs){
				let formargs = [
					["head","Address"],
					["text",account["address"]],
					["head","Balance"],
					["text",CallbackResult["balance"]],
					["head","Action"],
					[
						"download",
						"Save KeyFile",
						"TAKA_KeyFile_"+account["address"]+".json",
						"text/plain",
						JSON.stringify(account)
					],
					[
						"button",
						"Exchange ETAKA <=> TAKA",
						async function()
						{
							ExchangeForm(CallbackResult["balance"]);
						}
					],
					[
						"button",
						"Withdraw",
						function()
						{
							let formargs = [
								["title","Withdraw"],
								["input","toaddress","toaddress"],
								["input","amount","amount"],
								[
									"button",
									"send",
									function()
									{
										let toaddress = document.getElementById("toaddress").value;
										let amount = document.getElementById("amount").value;
										amount = parseInt(amount);


										let result = SendTransaction(1,"pay",toaddress,amount,"");


										//送信ロード画面
										let TopLoadForm = new form(
											[
												["title","Sending....."]
											],
											"TopLoadForm"
										);


										result.then(function(TxResult){
											TopLoadForm.DeleteForm();

											let TopResultForm = new form(
												[
													["title","Result"],
													["head","Result"],
													["input","result","result"],
													[
														"button",
														"State",
														function()
														{
															window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
														}
													],
													["head","RawTx"],
													["input","rawtx","rawtx"],
													[
														"button",
														"Done",
														function()
														{
															TopResultForm.DeleteForm();
															TopWithdrawForm.DeleteForm();
														}
													]
												],
												"TopResultForm"
											);

											document.getElementById("result").value = TxResult["txid"];
											document.getElementById("rawtx").value = TxResult["rawtx"];
										});
									}
								]
							]


							let TopWithdrawForm = new form(
								formargs,
								"TopWithdrawForm"
							);
						}
					],
					[
						"button",
						"Tag Order",
						function()
						{
							let TopTagOrderForm = new form(
								[
									["title","Tag Order"],
									["input","tag","tag"],
									["input","Permission Type","permissiontype"],
									["input","Pow Target","powtarget"],
									[
										"button",
										"send",
										function()
										{
											let tag = document.getElementById("tag").value;
											let permissiontype = document.getElementById("permissiontype").value;
											let powtarget = document.getElementById("powtarget").value;

											if (!powtarget){
												powtarget = "0000000000000000000000000000000000000000000000000000000000000000";
											};


											//FeeTx作成
											let result = SendTransaction(1,"pay","0000000000000000000000000000000000000000",1,"");


											//送信ロード画面
											let TopLoadForm = new form(
												[
													["title","Sending....."]
												],
												"TopLoadForm"
											);


											result.then(function(FeeTxResult){
												TopLoadForm.DeleteForm();
												if (!FeeTxResult){
													let TopFailForm = new form(
														[
															["title","FAIL"]
														],
														"TopFailForm"
													);
												}



												//TagOrderのデータ生成
												let objdata = {
													"feetxid":FeeTxResult["txid"],
													"permissiontype":permissiontype,
													"powtarget":powtarget,
												};

												let TXDATA = new TAKA.TRANSACTIONTOOLS_TAGORDER.TagOrderData("",objdata);
												let rawdata = TXDATA.GetRawData();



												//TagOrderTx作成
												let TagOrderResult = SendTransaction(12,tag,"0000000000000000000000000000000000000000",0,rawdata);

												TopLoadForm = new form(
													[
														["title","Sending....."]
													],
													"TopLoadForm"
												);

												TagOrderResult.then(function(TxResult){
													TopLoadForm.DeleteForm();

													let TopResultForm = new form(
														[
															["title","Result"],
															["head","Result"],
															["input","result","result"],
															[
																"button",
																"State",
																function()
																{
																	window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
																}
															],
															["head","RawTx"],
															["input","rawtx","rawtx"],
															[
																"button",
																"Done",
																function()
																{
																	TopResultForm.DeleteForm();
																	TopTagOrderForm.DeleteForm();
																}
															]
														],
														"TopResultForm"
													);

													document.getElementById("result").value = TxResult["txid"];
													document.getElementById("rawtx").value = TxResult["rawtx"];
												}).catch(function(e){
													console.log(e);
												});
											}).catch(function(e){
												console.log(e);
											});
										}
									]
								],
								"TopTagOrderForm"
							);
						}
					],
					[
						"button",
						"Tag Reward",
						function()
						{
							let TopTagrewardForm = new form(
								[
									["title","Tag Reward"],
									["text","You can pay reward for node administrator keeping the specified tag."],
									["input","tag","tag"],
									["input","amount","amount"],
									[
										"button",
										"send",
										async function()
										{
											let tag = document.getElementById("tag").value;
											let amount = document.getElementById("amount").value;

											let TagData = TAKAAPI.gettag(tag);
											let TagsMerkleRoot = TagData["MerkleRoot"];
											if (!TagsMerkleRoot){
												let TopFailForm = new form(
													[
														["title","FAIL"]
													],
													"TopFailForm"
												);
											}

											let RewardPrivkeyKeys = await (new TAKA.ACCOUNT.account().GetKeys());
											let EncryptoPrivkey = new TAKA.CRYPTO.common().GetEncryptedData(TagsMerkleRoot,RewardPrivkeyKeys["privkey"]);


											//送信ロード画面
											let TopLoadForm = new form(
												[
													["title","Sending....."]
												],
												"TopLoadForm"
											);


											let result = SendTransaction(1,"pay",RewardPrivkeyKeys["address"],amount,"");


											result.then(function(FeeTxResult){
												TopLoadForm.DeleteForm();
												if (!FeeTxResult){
													let TopFailForm = new form(
														[
															["title","FAIL"]
														],
														"TopFailForm"
													);
												}



												//tagrewardのデータ生成
												let objdata = {
													"tag":tag,
													"EncryptoPrivkey":EncryptoPrivkey,
												};

												let TXDATA = new TAKA.TRANSACTIONTOOLS_TAGREWARD.TagrewardData("",objdata);
												let rawdata = TXDATA.GetRawData();



												TopLoadForm = new form(
													[
														["title","Sending....."]
													],
													"TopLoadForm"
												);

												//TagrewardTx作成
												let TagrewardResult = SendTransaction(11,"tagreward","0000000000000000000000000000000000000000",0,rawdata);


												///Tagrewardの結果発表
												TagrewardResult.then(function(TxResult){
													TopLoadForm.DeleteForm();

													let TopResultForm = new form(
														[
															["title","Result"],
															["head","Result"],
															["input","result","result"],
															[
																"button",
																"State",
																function()
																{
																	window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
																}
															],
															["head","RawTx"],
															["input","rawtx","rawtx"],
															[
																"button",
																"Done",
																function()
																{
																	TopResultForm.DeleteForm();
																	TopTagrewardForm.DeleteForm();
																}
															]
														],
														"TopResultForm"
													);

													document.getElementById("result").value = TxResult["txid"];
													document.getElementById("rawtx").value = TxResult["rawtx"];
												}).catch(function(e){
													console.log(e);
												});

											}).catch(function(e){
												console.log(e);
											});
										}
									]
								],
								"TopTagrewardForm",
							);
						}
					],
					[
						"button",
						"Tag Add Permit",
						function()
						{
							let TopTagAddpermForm = new form(
								[
									["title","Tag Add Permit"],
									["input","tag","tag"],
									["input","Add address","addaddress"],
									[
										"button",
										"send",
										function()
										{
											let tag = document.getElementById("tag").value;
											let addaddress = document.getElementById("addaddress").value;

											//tagrewardのデータ生成
											let objdata = {
												"address":addaddress,
											};

											let TXDATA = new TAKA.TRANSACTIONTOOLS_TAGADDPERMIT.TagAddPermitData("",objdata);
											let rawdata = TXDATA.GetRawData();

											let result = SendTransaction(13,tag,"0000000000000000000000000000000000000000",0,rawdata);


											//送信ロード画面
											let TopLoadForm = new form(
												[
													["title","Sending....."]
												],
												"TopLoadForm"
											);

											result.then(function(TxResult){
												TopLoadForm.DeleteForm();

												let TopResultForm = new form(
													[
														["title","Result"],
														["head","Result"],
														["input","result","result"],
														[
															"button",
															"State",
															function()
															{
																window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
															}
														],
														["head","RawTx"],
														["input","rawtx","rawtx"],
														[
															"button",
															"Done",
															function()
															{
																TopResultForm.DeleteForm();
																TopTagOrderForm.DeleteForm();
															}
														]
													],
													"TopResultForm"
												);

												document.getElementById("result").value = TxResult["txid"];
												document.getElementById("rawtx").value = TxResult["rawtx"];

											}).catch(function(e){
												console.log(e);
											});


										}
									]
								],
								"TopTagAddpermForm",
							);
						}
					],
					[
						"button",
						"Database",
						function()
						{
							let TopDatabaseForm = new form(
								[
									["title","Database"],
									["input","tag","tag"],
									["input","data","data"],
									["input","commonkey","commonkey"],
									[
										"button",
										"send",
										function()
										{


											let tag = document.getElementById("tag").value;
											let data = document.getElementById("data").value;
											let commonkey = document.getElementById("commonkey").value;


											if (commonkey){
												data = new TAKA.CRYPTO.common().GetEncryptedData(commonkey,data);
											}


											let result = SendTransaction(101,tag,"0000000000000000000000000000000000000000",0,data);


											//送信ロード画面
											let TopLoadForm = new form(
												[
													["title","Sending....."]
												],
												"TopLoadForm"
											);

											result.then(function(TxResult){
												TopLoadForm.DeleteForm();

												let TopResultForm = new form(
													[
														["title","Result"],
														["head","Result"],
														["input","result","result"],
														[
															"button",
															"State",
															function()
															{
																window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
															}
														],
														["head","RawTx"],
														["input","rawtx","rawtx"],
														[
															"button",
															"Done",
															function()
															{
																TopResultForm.DeleteForm();
																TopDatabaseForm.DeleteForm();
															}
														]
													],
													"TopResultForm"
												);

												document.getElementById("result").value = TxResult["txid"];
												document.getElementById("rawtx").value = TxResult["rawtx"];
												
											}).catch(function(e){
												console.log(e);
											});


										}
									]
								],
								"TopDatabaseForm",
							);
						}
					],
					[
						"button",
						"Send Set Contract Transaction",
						function()
						{
							let SendSetContractTransactionForm = new form(
								[
									["title","Send Set Contract Transaction"],
									["input","tag","tag"],
									["input","FunctionName","FunctionName"],
									["select","CodeType",[["JavaScript",1]]],
									["textblog","CodeData","CodeData"],
									[
										"button",
										"send",
										function()
										{


											let tag = document.getElementById("tag").value;
											let FunctionName = document.getElementById("FunctionName").value;
											let CodeType = document.getElementById("CodeType").value;
											let CodeData = document.getElementById("CodeData").value;


											//tagrewardのデータ生成
											let objdata = {
												"FunctionName":FunctionName,
												"CodeType":CodeType,
												"CodeData":CodeData,
											};
											let TXDATA = new TAKA.TRANSACTIONTOOLS_CONTRACT.SetFunctionData("",objdata);
											let rawdata = TXDATA.GetRawData();

											let result = SendTransaction(111,tag,"0000000000000000000000000000000000000000",0,rawdata);


											//送信ロード画面
											let TopLoadForm = new form(
												[
													["title","Sending....."]
												],
												"TopLoadForm"
											);

											result.then(function(TxResult){
												TopLoadForm.DeleteForm();

												let TopResultForm = new form(
													[
														["title","Result"],
														["head","Result"],
														["input","result","result"],
														[
															"button",
															"State",
															function()
															{
																window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
															}
														],
														["head","RawTx"],
														["input","rawtx","rawtx"],
														[
															"button",
															"Done",
															function()
															{
																TopResultForm.DeleteForm();
																SendSetContractTransactionForm.DeleteForm();
															}
														]
													],
													"TopResultForm"
												);

												document.getElementById("result").value = TxResult["txid"];
												document.getElementById("rawtx").value = TxResult["rawtx"];
												
											}).catch(function(e){
												console.log(e);
											});


										}
									]
								],
								"SendSetContractTransactionForm",
							);
						}
					],
					[
						"button",
						"Call Run Contract Transaction",
						function()
						{
							let CallRunContractTransactionForm = new form(
								[
									["title","Call Run Contract Transaction"],
									["input","tag","tag"],
									["input","FunctionName","FunctionName"],
									["input","FunctionArgs","FunctionArgs"],
									[
										"button",
										"send",
										function()
										{
											let address = account["address"];
											let tag = document.getElementById("tag").value;
											let FunctionName = document.getElementById("FunctionName").value;
											let FunctionArgs = JSON.parse(document.getElementById("FunctionArgs").value);


											let result = TAKAAPI.CallRunContractTransaction(address,tag,FunctionName,FunctionArgs);


											let TopResultForm = new form(
												[
													["title","Result"],
													["head","Result"],
													["input","result","result"],
													["head","RawTx"],
													["input","rawtx","rawtx"],
													[
														"button",
														"Done",
														function()
														{
															TopResultForm.DeleteForm();
															CallRunContractTransactionForm.DeleteForm();
														}
													]
												],
												"TopResultForm"
											);

											document.getElementById("result").value = result;
											document.getElementById("rawtx").value = "";


										}
									]
								],
								"CallRunContractTransactionForm",
							);
						}
					],
					[
						"button",
						"Send Run Contract Transaction",
						function()
						{
							let SendRunContractTransactionForm = new form(
								[
									["title","Send Run Contract Transaction"],
									["input","tag","tag"],
									["input","FunctionName","FunctionName"],
									["input","FunctionArgs","FunctionArgs"],
									[
										"button",
										"send",
										function()
										{
											let address = account["address"];
											let tag = document.getElementById("tag").value;
											let FunctionName = document.getElementById("FunctionName").value;
											let FunctionArgs = JSON.parse(document.getElementById("FunctionArgs").value);


											let ResultPlan = TAKAAPI.RunCode(address,tag,FunctionName,FunctionArgs)


											//tagrewardのデータ生成
											let objdata = {
												"FunctionName":FunctionName,
												"FunctionArgs":FunctionArgs,
												"result":ResultPlan["result"],
												"SetData":ResultPlan["SetData"],
											};
											let TXDATA = new TAKA.TRANSACTIONTOOLS_CONTRACT.RunFunctionData("",objdata);
											let rawdata = TXDATA.GetRawData();

											let result = SendTransaction(112,tag,"0000000000000000000000000000000000000000",0,rawdata);


											//送信ロード画面
											let TopLoadForm = new form(
												[
													["title","Sending....."]
												],
												"TopLoadForm"
											);

											result.then(function(TxResult){
												TopLoadForm.DeleteForm();

												let TopResultForm = new form(
													[
														["title","Result"],
														["head","Result"],
														["input","result","result"],
														[
															"button",
															"State",
															function()
															{
																window.open(location.protocol+'//'+location.hostname+'/explorer?page=tx&txid='+TxResult["txid"], '_blank');
															}
														],
														["head","RawTx"],
														["input","rawtx","rawtx"],
														[
															"button",
															"Done",
															function()
															{
																TopResultForm.DeleteForm();
																SendRunContractTransactionForm.DeleteForm();
															}
														]
													],
													"TopResultForm"
												);

												document.getElementById("result").value = TxResult["txid"];
												document.getElementById("rawtx").value = TxResult["rawtx"];
												
											}).catch(function(e){
												console.log(e);
											});


										}
									]
								],
								"SendRunContractTransactionForm",
							);
						}
					],


				];

				let TopForm = new form(
					formargs,
					"TopForm"
				);

				LoginLoadForm.DeleteForm();
			},
			{}
		);

		return true;
	}
</script>





<script>
	window.onload = function(){

		let EleLogin = element(
			{
				"name":"EleLogin",
				"attachele":document.body,
				"type":"div",
				"height":"50%",
				"width":"100%",
				"position":"fixed",
				"top":"0px",
				"left":"0px",
				"color":"rgba(0,0,0,1)",
				"backgroundColor":"rgba(255,127,0,1)",
			}
		);





		let EleLoginInner = element(
			{
				"name":"EleLoginInner",
				"attachele":EleLogin,
				"type":"div",
				"width":"100%",
				"maxWidth":"1024px",
				"position":"relative",
			}
		);
		var IntervalID_EleLoginInner = setInterval(
			function()
			{
				if (document.getElementById("EleLoginInner") == null){clearInterval(IntervalID_EleLoginInner);return 0;};

				EleLogin.style.top = window.innerHeight/2 - EleLogin.clientHeight/2 + "px";

				EleLoginInner.style.top = EleLogin.clientHeight/2 - EleLoginInner.clientHeight/2 + "px";
				EleLoginInner.style.left = EleLogin.clientWidth/2 - EleLoginInner.clientWidth/2 + "px";
			},
			10
		);



		let EleInputLogin = element(
			{
				"name":"privkey",
				"attachele":EleLoginInner,
				"type":"input",
				"height":"50px",
				"width":"100%",
				"placeholder":"MinPrivkey, privkey, pubkey, address",
				"textAlign":"center",
			}
		);
		let EleButtonLogin = element(
			{
				"name":"EleButtonLogin",
				"attachele":EleLoginInner,
				"type":"a",
				"class":"btn-border-bottom",
				"height":"50px",
				"width":"100%",
				"innerHTML":"Login",
				"textAlign":"center",
				"clickfunction":async function(){
					let privkey = document.getElementById("privkey").value;

					let keys = await (new TAKA.ACCOUNT.account(privkey)).GetKeys();

					account = keys;

					TopForm();
				}
			}
		);
		let EleButtonKeyFileLoad = element(
			{
				"name":"EleButtonKeyFileLoad",
				"attachele":EleLoginInner,
				"type":"a",
				"class":"btn-border-bottom",
				"height":"50px",
				"width":"100%",
				"innerHTML":"KeyFile Load",
				"textAlign":"center",
				"clickfunction":async function(){
					let FORMACTION = new form(
						[
							["title","Load KeyFile"],
							["file","FileData"],
							[
								"button",
								"Done",
								async function(){
									let FileData = document.getElementById("FileData").value;
									let data = (FileData.split(',')).slice(-1)[0];
									data = window.atob(data);
									data = JSON.parse(data);

									document.getElementById("privkey").value = data["MinPrivkey"];
									FORMACTION.DeleteForm();
								}
							]
						],
						"FORMACTION"
					);
				}
			}
		);
		let EleButtonNewAccount = element(
			{
				"name":"EleButtonNewAccount",
				"attachele":EleLoginInner,
				"type":"a",
				"class":"btn-border-bottom",
				"height":"50px",
				"width":"100%",
				"innerHTML":"NewAccount",
				"textAlign":"center",
				"clickfunction":async function(){
					let keys = await (new TAKA.ACCOUNT.account()).GetKeys();

					let LoginNewAccountForm = new form(
						[
							["title","New Account"],
							[
								"download",
								"Save KeyFile",
								"TAKA_KeyFile_"+keys["address"]+".json",
								"text/plain",
								JSON.stringify(keys)
							],
							["head","MinPrivkey"],
							["text","SAVE THIS! AND NOT BE SHOWN TO PEOPLE!"],
							["input","MinPrivkey","MinPrivkey"],
							["head","Privkey"],
							["input","privkey","mprivkey"],
							["head","Pubkey"],
							["input","pubkey","pubkey"],
							["head","Address"],
							["text","THIS IS USING RECEIVE COINS! YOU CAN SHOW THIS!"],
							["input","address","address"],
						],
						"LoginNewAccountForm"
					);
					document.getElementById("MinPrivkey").value = keys["MinPrivkey"];
					document.getElementById("privkey").value = keys["MinPrivkey"];
					document.getElementById("mprivkey").value = keys["privkey"];
					document.getElementById("pubkey").value = keys["pubkey"];
					document.getElementById("address").value = keys["address"];
				}
			}
		);
	};

</script>